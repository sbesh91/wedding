
import { LitElement, html } from '@polymer/lit-element/lit-element';
import { installRouter } from 'pwa-helpers/router';
import { routes, navigate, generatePageTransitionAnimation, generateHeroTransitionAnimation, generateBaseLoadAnimation} from './app';
import 'web-animations-js';

// Create your custom component
class AppShell extends LitElement {
  // Initialize properties

  constructor() {
    super();
    
    installRouter((location, event) => this.viewChange(location, event));
    this.currentLocation = location.pathname;
  }

  setupObserver() {
    const nav = this.shadowRoot.querySelector('nav');
    const body = this.shadowRoot.querySelector('main');
    const header = this.shadowRoot.querySelector('header');

    const observer = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (!entry.isIntersecting) {
          nav.classList.add('scroll');
          body.classList.add('scroll');
        } else {
          nav.classList.remove('scroll');
          body.classList.remove('scroll');
        }
      });
    });

    observer.observe(header);
  }

  async viewChange(location, event) {
    if (!this.currentLocation) {
      await navigate(window.decodeURIComponent(location.pathname));
      const firstView = this.shadowRoot.querySelector(routes[location.pathname].selector);
      generateBaseLoadAnimation(firstView, 'forwards');
      firstView.classList.add('active');
      this.setupObserver();
      return;
    }

    const oldView = this.shadowRoot.querySelector(routes[this.currentLocation].selector);
    // const fromNode = oldView.shadowRoot.querySelector('div');
    generatePageTransitionAnimation(oldView, 'backwards');
    // toss up a spinner
    await navigate(window.decodeURIComponent(location.pathname));
    oldView.classList.remove('active');
    this.currentLocation = location.pathname;
    
    const newView = this.shadowRoot.querySelector(routes[location.pathname].selector);
    // const toNode = newView.shadowRoot.querySelector('div');
    // generateHeroTransitionAnimation(toNode, fromNode, newView, oldView);
    generatePageTransitionAnimation(newView, 'forwards');
    newView.classList.add('active')
  }

  renderLink(route) {
    return html`
    <a href="${route.url}">
      ${route.label}
    </a>`;
  }
  
  render() {
    return html`
    <style>
      :host {
        display: grid;
        grid-template-rows: 14rem 4rem 1fr;
        grid-gap: 1rem;
        height: 100%;
      }

      a {
        cursor: pointer;
        font-size: 2rem;
        line-height: 2rem;
        text-decoration: none;
        color: #616161;
      }

      main {
        position: relative;
      }

      nav {
        top: 0;
        position: sticky;
        background: #f5f5f5;
        padding: 1rem;
        transition: 500ms ease;
        transition-property: box-shadow, background;
        display: flex;
        justify-content: space-between;
      }

      nav.scroll {
        z-index: 1;
        box-shadow: 0 1px 3px rgba(0,0,0,0.16), 0 1px 3px rgba(0,0,0,0.23);
        background: #eeeeee;
      }

      main > * {
        display: block;
        position: absolute;
        pointer-events: none;
        opacity: 0;
        top: 0;
        left: 0;
        max-height: 50vh;
        overflow: hidden;
      }

      header {
        display: flex;
        justify-content: center;
        align-items: center;
      }

      header svg {
        height: 95%;
        width: 95%;
      }

      .active {
        position: relative;
        max-height: none;
        overflow: auto;
        pointer-events: auto !important;
        opacity: 1 !important;
      }
    </style>
    <header>
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1080 400"><defs><style>.cls-1{fill:none;}.cls-2{clip-path:url(#clip-path);}</style><clipPath id="clip-path"><rect class="cls-1" x="-802" y="-156" width="3053" height="805"/></clipPath></defs><title>names</title><g class="cls-2"><path d="M247.59,114.84c-5.26,3-10.29,5.9-15.31,9.08-17.12,11-33.27,23.12-55.15,38-3.19,2.19-9.59,6.11-14.47,6.26-5.58.17-8-3.48-7.93-8.14-.23-15.12,16.49-39.13,24.05-50.76-10.73,14.29-25.95,34.07-36.88,34.4-9.06.28-13.24-6.81-11.6-14.07-19.76,15.73-48.37,23.58-82.3,25.08-119.43,5.51-368.13-115.34-417-1-.21.71-1.86-.17-1.65-.88,51.22-120.69,294.51,5.67,418.35,0,36.49-1.58,66.93-10.42,85.43-29.37,10.37-11,28-13.65,44-14.6.45-.48.66-1.19,1.11-1.67,6.27-8.1,17.42-1,11.66,8.49-10.43,16.61-29.23,48.59-22.5,48.15,3-.32,6-2.27,9-4.23,21.9-14.16,42.79-31.09,70.24-46.58C247.75,112.51,248.5,114.11,247.59,114.84Zm-72.69-3.13c-15,4.18-29.9,11.38-35,19.91-2.22,3.79-3.67,9.42,2.6,9.23C151.58,140.57,164.38,125.52,174.9,111.71Zm125.92,1.49c-14.19,7.88-38.45,28.63-53.95,31.43-2.79,7.76-6,17.63-16.54,22.38-10.1,4.49-23.66,2.35-23.83-10.68-.27-9.06,7.49-14,15.86-14.21,3.48-.1,7,.72,10.49.84,4.16-16.18,5.24-34.36,30.51-37.22,1.62-.29,1.69,1.81.3,2.08-18.78,2.2-11.09,17.79-16.16,34.7,14.1-3,39.3-23.54,52.56-31.16C301.21,110.86,302,112.47,300.82,113.2Zm-68.61,31.65a64.81,64.81,0,0,0-9.8-.87c-7.2.22-14.06,4.39-13.81,12.29a8.66,8.66,0,0,0,9.34,8.79C225.37,164.6,230.56,151.64,232.21,144.85Zm200.41-35.91c-22,12.54-69.12,53.07-89.11,53.68-7,.21-11.74-3.6-11.5-10.82.58-19.09,37.82-57,30.22-54.44-18.9,5.93-49.68,34.33-67.9,47.22L293,146.71c-3.56,5.46-17.83,2.87-9.65-11.34C315.6,79.24,364.92,10.26,397,7.89,406,7.14,411.05,12.11,411.52,20c2.25,35.53-70.54,75-96.88,88.58-6.63,11.6-12.56,22.95-18.1,32.2,13.62-11.12,54.68-45.88,68.39-46.3,29.28-1.13-35.23,65.53-18.95,65,18.82-.81,65.08-40.38,85.66-52.18C432.55,106.85,433.31,108.69,432.62,108.94Zm-116.21-3.43C339.76,93.16,409.77,54,407.65,22.68c-.42-6-4-9.65-11.44-8.72C375.35,16.46,341.21,64.27,316.41,105.51Zm132.12-1c-5.55,8.78-32.38,51.94-24.25,51.46,3.25-.33,6-2.27,8.94-4.23,22.14-14.17,42.8-31.09,70.48-46.59.91-.49,1.89,1.11.75,1.84-5.26,3-10.29,5.9-15.31,9.08-17.12,11-33.27,23.12-55.15,38-3,2.18-9.35,6.1-14.47,6.26-5.58.17-7.78-3.49-7.92-8.14C411.3,119.6,492.08,6.61,530.85,3.79c9-.74,14.09,4.23,14.57,12.12C547.66,51.45,474.88,90.9,448.53,104.5Zm1.77-3.08c23.36-12.35,93.36-51.48,91.24-82.83-.42-6-4.25-9.64-11.43-8.72C509,12.37,475.1,60.18,450.3,101.42Zm139.7,3c-19.44,11.06-73.79,52.51-92.15,53.07-32.09.75-2.29-67.41,35.1-69.71,13.94-.66,9.5,13.9-6.85,19.52a108.49,108.49,0,0,1-12.22,3.63c-4.42,7.58-31,44.92-15.86,44.46,17-.52,70.64-41,91-52.57C590.39,102,591.38,103.86,590,104.37Zm609.89,1.38c-60-119.62-372.46,63-529.18,35.71-20.36-3.57-38.6-6.74-57.78-2.2C594.78,169.6,552.35,243,519.2,247.06c-9,1.21-14.3-3.52-15.24-11.4-3.54-32.23,61.83-78.2,91.65-92.38,5.09-8.53,10.4-17.3,15.95-26.08-7.43,7.91-15.55,16.3-21.24,20.66a15.54,15.54,0,0,1-8.49,4c-4.86.62-8.88-1.36-9.08-7.86-.18-5.82,6.2-17.88,12.18-27.83,5.3-9.24,18.08-2.42,12.09,7.07C588.8,126,581.47,137.43,586.8,136.8c4.18-.12,23.3-21.88,31.85-31.22a50,50,0,0,0,2.88-4.74c4.22-6.64,15.56-.94,11.12,5.94-6.65,10.91-12.41,20.39-18.16,30.11,18.5-3.82,36.51-.65,56.63,2.92,159.07,27.72,467.91-160.4,530.37-35C1201.74,105.46,1200.14,106.44,1199.89,105.75ZM593.61,146.37c-26.12,13.36-89.23,57.4-85.78,86.61.65,5.8,4.47,9.18,11.87,7.79C542.39,237.05,580.09,168.65,593.61,146.37Zm-77.72-38.11a67.76,67.76,0,0,0,9.69-2.86c12-4.09,18.15-15.21,9.57-14C531.44,91.73,524,98.94,515.89,108.26Z"/><path d="M557.26,338.39c-14.17,8.32-37.79,29.8-53.2,33.08-2.55,7.84-5.43,17.8-15.84,22.87-10,4.8-23.58,3.07-24.14-9.94-.32-9.07,7.05-14.18,15.64-14.71a75.52,75.52,0,0,1,10.28.54c1.51-5.92,2.28-12.26,4.26-18-19.44,17.27-48.25,26.25-82.81,28.83C292.25,390.24,40,277.06-5.36,392.83c-.19.71-1.87-.12-1.68-.83,47.51-122.2,294.53-3.33,418.14-12.75,37.33-3,67.71-13,85.58-33.19,4.63-8.21,10.2-12.28,22.68-14,1.61-.33,2,1.74.36,2.07-18.7,2.78-10.54,18.12-15.09,35.18,14.23-3.44,38.56-24.73,51.59-32.75C557.35,336.06,558.14,337.64,557.26,338.39Zm-67.61,33.73a74.23,74.23,0,0,0-9.82-.57c-7.42.45-13.93,4.58-13.66,12.72a8.66,8.66,0,0,0,9.6,8.5C483.42,392.07,488,378.74,489.65,372.12ZM629.23,334c-5.16,3.11-10.1,6.21-15,9.54-16.77,11.51-32.55,24.13-54,39.65-2.89,2.27-9.17,6.38-14.27,6.7-5.57.34-7.89-3.25-8.17-7.89-.65-14.41,16.28-46.2,29.55-69.14-8.82.54-18-.54-26.93-6-.72-.42.29-2.81,1.27-2.17,9.16,5,18.53,5.86,27.33,5.08,4.64-8,8.89-14.75,11.2-18.85,4.84-8.45,16.26-.77,11.61,7-1.26,2.17-3.17,5.31-5.26,9.17,11-2.31,20.69-4.53,27,.21,1,.64-.35,1.89-1.08,1.47-6.1-4.52-16.17-1.58-27.65,1.22-14.95,26.08-42.4,76.22-34.29,75.49,3.23-.43,5.9-2.46,8.81-4.5,21.69-14.84,41.82-32.38,69-48.72C629.32,331.65,630.35,333.22,629.23,334Zm85.89-5.25C696,340.38,643,383.47,624.64,384.59c-32,1.73-4.35-67.3,33-70.75,13.91-1.08,9.91,13.61-6.25,19.72a104.69,104.69,0,0,1-12.11,4c-4.19,7.72-29.58,45.85-14.49,44.93,16.94-1,69.35-43.16,89.35-55.33C715.45,326.38,716.49,328.18,715.12,328.73Zm-73.94,6.15a66.87,66.87,0,0,0,9.59-3.15c11.84-4.45,17.67-15.76,9.14-14.3C656.21,317.89,649,325.32,641.18,334.88ZM794,323.67c-8,6.31-26.44,13.5-36.28,8.74-10.33,13.92-30.38,32.85-43.32,42.26-2.9,2-9.17,6.15-14.05,6.45-5.8.36-9.15-1.07-9.51-6.87-.55-9.06,15.88-37.55,20.55-45.06,4.65-7.74,17.18-1.05,11.48,8.62-9.69,16.9-24.85,39.49-18.13,38.85,3.23-.43,6.15-2.24,9.06-4.28,11.39-7.92,33-28.12,42.47-40.81-5.61-4.08-4.65-15.09,2.05-16a4.1,4.1,0,0,1,4.08,1.85c2.31,3.58-1.25,10.09-3.39,13.25,9.11,4.11,26.39-2.78,33.74-8.35C793.9,321.35,794.71,323.16,794,323.67Zm-35.25-4.83c-4.64.28-4.13,8.64-1.43,10.8C758.45,328.41,763.67,318.54,758.79,318.84Zm121.38-.2c-19.09,11.65-72.14,54.73-90.48,55.86-32.05,1.72-4.35-67.31,32.95-70.75,13.92-1.09,9.92,13.6-6.25,19.72a106.48,106.48,0,0,1-12.1,4c-4.19,7.71-29.58,45.84-14.49,44.92,16.94-1,69.35-43.15,89.34-55.32C880.49,316.29,881.54,318.09,880.17,318.64Zm-73.95,6.15a69.13,69.13,0,0,0,9.6-3.15c11.84-4.45,17.67-15.76,9.14-14.31C821.26,307.79,814,315.22,806.22,324.79Zm698.44-24.31c-61-113-405,64.61-534.67,73.24-10.2.86-54.08,3.54-54.53-15.3-.3-12.57,25.69-44.68,19.43-44.3-16,.52-47.34,33.65-69.92,53a4.11,4.11,0,0,1-1.07,1.69c-3.18,5.09-15.82.27-11-8.18,8.81-15.92,16.55-30.37,24.82-43.69,4.44-7.5,15.9.89,12.08,6.95-7.62,12.58-14.71,26.29-22.11,38.63,23.21-20.52,53.59-53.37,73.12-54.1,20.69-.8-15.14,45.89-14.87,54,.31,12.8,34.41,10.25,43.69,9.68,133.9-8.89,472.95-191.09,536.58-72.65C1506.5,300.14,1504.93,301.17,1504.66,300.48Z"/><path d="M278.45,273.52c-3.74,1.71-7.33,3.43-10.92,5.31-12.26,6.51-23.93,13.84-39.65,22.71-2.3,1.31-6.87,3.61-10.19,3.44-3.81-.2-5.26-2.82-4.93-6,.69-10.29,13.42-25.68,19.21-33.16-8.1,9.11-19.57,21.7-27,21.31s-9.59-8-5.33-13.47c-15,6.68-30.07,15.74-22,34.76.43.82-.85,1.07-1.15.58-9.2-21.46,8.58-30.23,25-37.47,6.1-4.13,15.12-6.52,29.4-6.09.34-.3.52-.76.85-1.06,4.72-5.16,11.9.3,7.29,6.42-7.87,10.71-22.46,31.4-17.86,31.48,2.07-.05,4.2-1.21,6.33-2.37,15.69-8.39,30.85-18.72,50.39-27.71C278.69,271.94,279.11,273.08,278.45,273.52Zm-49.25-6.24c-10.44,2-21,6.05-24.92,11.57-1.72,2.45-3,6.2,1.25,6.42C211.71,285.6,221.27,276.08,229.2,267.28Zm137.52,10.87c-16.76,7.54-30.26,16.53-50.73,28-5.58,3.36-17.67,6.54-16.85-3,.77-8.54,20.87-28.31,16.59-28.53-10.92-.89-34.69,19.16-51.5,30.51a2.74,2.74,0,0,1-.85,1.07c-2.55,3.2-10.75-1-6.81-6.4,7.2-10.11,13.56-19.31,20.2-27.7,3.59-4.74,10.71,1.83,7.65,5.64-6.14,7.95-12,16.7-18,24.49,17.32-12.12,40.46-32.05,53.75-31,15.68,1.14-20.35,36.59-13.34,36.33,2.07,0,6.61-1.88,8.9-3,15.69-8.4,30.7-18.74,50.4-27.71C366.81,276.56,367.37,277.86,366.72,278.15Zm62.86-35c-3.9,4.56-53.6,67.59-46,67.67,2.23,0,4.2-1.21,6.48-2.36,15.7-8.39,30.86-18.72,50.4-27.71.65-.28,1.23.86.41,1.29-3.75,1.71-7.33,3.43-10.93,5.31-12.1,6.52-23.77,13.85-39.65,22.71-2.13,1.32-6.7,3.62-10,3.45-4-.21-5.25-2.82-5.09-6,.86-10.28,14.94-27.34,19.22-33.16.17-.15-17,21.83-26.86,21.32-12.36-.65-10.93-12.81-3.35-18,5.44-3.68,15.53-5.22,29.28-3.7,1.52-1.83,2.87-3.35,4.22-4.87,8.28-9.26,15.77-18.88,24.67-28-45.94-15-116.8-63.65-126-22-.2.79-1.45.41-1.25-.38,11.62-45.79,82.78,6.41,128.08,21.34,15.45-15.72,30.33-26.86,41.45-26.75C485.48,213.49,471,253.89,429.58,243.14ZM391.79,275.8c-11.18,1.17-21.86,4.74-25.8,10.25-1.72,2.45-2.3,7.51,2.13,7.74C374.3,294.12,383.7,284.6,391.79,275.8Zm38.63-33.57c38.28,9.48,50.43-25.32,33.4-24.79C454.75,217.76,442.59,228.41,430.42,242.23Z"/></g></svg>
    </header>
    <nav>
      ${Object.keys(routes).map(i => this.renderLink(routes[i]))}
    </nav>
    <main>
      <home-page></home-page>
      <about-page></about-page>
      <not-found></not-found>
    </main>
    `;
  }
}
// Register the element with the browser
customElements.define('app-shell', AppShell);